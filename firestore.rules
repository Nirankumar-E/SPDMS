
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    function isSignedIn() {
      return request.auth != null;
    }

    match /citizens/{citizenId} {
      // Allow an unauthenticated 'get' for the login page to check if a card exists.
      allow get: if request.auth == null;

      // Allow an authenticated user to read and update their own document.
      // This relies on the client only requesting the document for the logged-in user.
      // WARNING: This is not secure against a malicious client who could guess other card numbers.
      allow get, update: if isSignedIn();
      
      // Disallow listing the entire collection, creating, or deleting.
      allow list, create, delete: if false;
    }

    match /bookings/{citizenId} {
       // Allow an authenticated user to manage their booking.
       // This relies on the client only accessing the booking for the logged-in user.
       // WARNING: This is not secure against a malicious client.
      allow get, create, update, delete: if isSignedIn();
      allow list: if false;
    }
  }
}
