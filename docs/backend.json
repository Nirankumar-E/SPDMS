{
  "entities": {
    "Beneficiary": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Beneficiary",
      "type": "object",
      "description": "Represents a beneficiary in the Public Distribution System.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Beneficiary entity."
        },
        "smartCardNumber": {
          "type": "string",
          "description": "The unique Smart Card number assigned to the beneficiary."
        },
        "name": {
          "type": "string",
          "description": "Name of the beneficiary."
        },
        "address": {
          "type": "string",
          "description": "Address of the beneficiary."
        },
        "phoneNumber": {
          "type": "string",
          "description": "Phone number registered with the smart card."
        },
        "familyCardId": {
          "type": "string",
          "description": "Reference to FamilyCard. (Relationship: FamilyCard 1:N Beneficiary)"
        }
      },
      "required": [
        "id",
        "smartCardNumber",
        "name",
        "address",
        "phoneNumber",
        "familyCardId"
      ]
    },
    "FamilyCard": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FamilyCard",
      "type": "object",
      "description": "Represents a family card in the Public Distribution System.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the FamilyCard entity."
        },
        "cardNumber": {
          "type": "string",
          "description": "The unique card number assigned to the family."
        },
        "headOfFamily": {
          "type": "string",
          "description": "Name of the head of the family."
        },
        "address": {
          "type": "string",
          "description": "Address of the family."
        },
        "cardType": {
          "type": "string",
          "description": "Type of the family card (e.g., AAY, PHH)."
        }
      },
      "required": [
        "id",
        "cardNumber",
        "headOfFamily",
        "address",
        "cardType"
      ]
    },
    "Grievance": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Grievance",
      "type": "object",
      "description": "Represents a grievance submitted by a beneficiary.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Grievance entity."
        },
        "beneficiaryId": {
          "type": "string",
          "description": "Reference to Beneficiary. (Relationship: Beneficiary 1:N Grievance)"
        },
        "submissionDate": {
          "type": "string",
          "description": "Date when the grievance was submitted.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of the grievance."
        },
        "status": {
          "type": "string",
          "description": "Status of the grievance (e.g., Open, In Progress, Resolved)."
        }
      },
      "required": [
        "id",
        "beneficiaryId",
        "submissionDate",
        "description",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/beneficiaries/{beneficiaryId}",
        "definition": {
          "entityName": "Beneficiary",
          "schema": {
            "$ref": "#/backend/entities/Beneficiary"
          },
          "description": "Stores beneficiary data, indexed by document id. The document id is also stored in the id property.",
          "params": [
            {
              "name": "beneficiaryId",
              "description": "The unique identifier of the beneficiary document. This is also stored in the `id` property."
            }
          ]
        }
      },
      {
        "path": "/familyCards/{familyCardId}",
        "definition": {
          "entityName": "FamilyCard",
          "schema": {
            "$ref": "#/backend/entities/FamilyCard"
          },
          "description": "Stores data about the family cards, indexed by familyCardId.",
          "params": [
            {
              "name": "familyCardId",
              "description": "The unique identifier of the family card document."
            }
          ]
        }
      },
      {
        "path": "/grievances/{grievanceId}",
        "definition": {
          "entityName": "Grievance",
          "schema": {
            "$ref": "#/backend/entities/Grievance"
          },
          "description": "Stores grievances submitted by beneficiaries. Each document includes the beneficiaryId.",
          "params": [
            {
              "name": "grievanceId",
              "description": "The unique identifier of the grievance document."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support a secure smart card-based login for the Citizen Public Distribution System (PDS) web application. The core principle is Authorization Independence, achieved by avoiding `get()` calls in security rules. This is realized through structural segregation and by storing all authorization-relevant data directly within the documents that need protection. The structure facilitates straightforward security rules, enabling simple `list` operations and maintaining the integrity of ownership and timestamps.\n\nThe `beneficiaries` collection stores the core user data, indexed by `smartCardNumber` for efficient login validation. The `familyCards` collection stores data about the family cards. The `grievances` collection stores grievances submitted by the beneficiaries.\n\nThis structure is designed to ensure that:\n\n1.  **Authorization Independence:** Security rules can be written based solely on the content of the request and the document being accessed, without needing to fetch data from parent documents.\n2.  **Clarity of Intent:** The structure clearly indicates the authorization requirements for each collection.\n3.  **No Custom Claims (DBAC):** Roles and permissions are managed within the database itself.\n4.  **Rules are not Filters (QAPs):** Security rules can efficiently filter data during `list` operations without requiring complex queries or client-side filtering.\n5.  **Invariants:** The structure supports maintaining the integrity of ownership, timestamps, and denormalized data."
  }
}